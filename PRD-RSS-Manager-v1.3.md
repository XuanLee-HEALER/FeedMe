# RSS Manager 状态栏应用 — Minor 版本 PRD

**版本**: v1.x（Minor Update）
**文档日期**: 2025-02-05
**状态**: Draft

---

## 1. 背景与目标

本次更新为 minor 版本，主要目标是提升用户在状态栏菜单中的信息检索效率和订阅源组织能力。新增功能包括文章搜索、订阅源分组、批量已读操作以及订阅源 favicon 展示。

---

## 2. 功能清单

| # | 功能 | 优先级 |
|---|------|--------|
| F1 | 左键菜单内文章搜索 | P0 |
| F2 | 订阅源 Tag 分组 | P0 |
| F3 | 组内批量标记已读 | P1 |
| F4 | 订阅源 Favicon 展示 | P1 |

---

## 3. 功能详细描述

### F1 — 左键菜单内文章搜索

**概述**: 在状态栏左键菜单顶部新增一个内联搜索框，用户可直接搜索已订阅的文章内容，无需打开独立窗口。

**交互流程**:

1. 用户点击状态栏图标，弹出左键菜单
2. 菜单顶部展示一个搜索框，样式参考 Spotlight 的搜索输入框（圆角、带搜索图标、placeholder 文案为"搜索文章…"）
3. 用户输入关键词后，菜单中原本展示「最近文章」的区域被搜索结果替换
4. 搜索结果的每一行样式与「最近文章」列表项保持完全一致（标题、来源、时间等字段）
5. 清空搜索框或点击清除按钮后，恢复展示「最近文章」列表

**搜索范围**: 当前所有订阅源中的已拉取文章（本地数据），匹配字段包括文章标题和文章摘要。

**性能要求**: 搜索应支持实时过滤（输入即搜索），响应延迟不超过 100ms。

**边界情况**:
- 搜索无结果时，在列表区域展示空状态提示，如"未找到相关文章"
- 搜索框获得焦点时不影响菜单的正常显示和关闭行为

---

### F2 — 订阅源 Tag 分组

**概述**: 支持为订阅源添加 Tag，并在状态栏菜单（左键和右键）中按 Tag 对订阅源进行分组展示。

**数据模型**:
- 每个订阅源可以关联一个 Tag（字符串类型）
- Tag 为空或未设置时，该订阅源归类为「未分组」
- Tag 由用户在订阅源管理界面中设置

**菜单展示规则**:
- 有 Tag 的订阅源按 Tag 聚合为二级菜单组，Tag 名称作为组的标题
- 未分组的订阅源直接平铺展示，与 Tag 分组同级
- 展示顺序：未分组订阅源在前，Tag 分组在后（Tag 分组之间按字母/拼音排序）
- 左键菜单和右键菜单的分组结构保持完全一致

**示例菜单结构**:

```
├── 订阅源 A（未分组）
├── 订阅源 B（未分组）
├── ▸ Rust           ← Tag 分组，展开为二级菜单
│   ├── Rust Blog
│   ├── Inside Rust
│   └── This Week in Rust
├── ▸ Infra
│   ├── Mitchell Hashimoto
│   └── ...
```

**订阅源管理界面变更**:
- 订阅源编辑表单中新增「Tag」字段，支持手动输入或从已有 Tag 中选择
- Tag 支持创建、编辑，删除操作通过清空订阅源上的 Tag 实现（无独立的 Tag 管理入口）

---

### F3 — 组内批量标记已读

**概述**: 在右键菜单中，支持对某个 Tag 分组下的所有订阅源的文章进行批量标记已读。

**交互流程**:

1. 用户在右键菜单中看到 Tag 分组（二级菜单）
2. 每个 Tag 分组的二级菜单底部提供「全部标记为已读」选项
3. 点击后，该 Tag 下所有订阅源的未读文章全部标记为已读
4. 菜单中对应订阅源的未读计数立即更新为 0

**单一订阅源已读**:
- 右键菜单中，每个订阅源（无论是否在分组内）同样提供「标记为已读」选项
- 点击后，该订阅源下所有未读文章标记为已读，未读计数立即归零

**边界情况**:
- 如果该组内或该订阅源已无未读文章，「全部标记为已读」/「标记为已读」选项置灰（disabled）

---

### F4 — 订阅源 Favicon 展示

**概述**: 在菜单的订阅源列表项中展示对应网站的 favicon，提升视觉辨识度。

**获取策略**:
- 首次添加订阅源时，尝试从订阅源 URL 对应的域名获取 favicon（`https://{domain}/favicon.ico`，或从 HTML 的 `<link rel="icon">` 中解析）
- 如果首次获取失败（网络问题、无 favicon 等），不阻塞订阅源添加流程，favicon 留空
- 在下一次订阅源刷新周期中，对 favicon 为空的订阅源重新尝试获取
- 获取成功后本地缓存，后续不再重复请求（除非用户手动编辑了订阅源 URL）

**展示规则**:
- Favicon 展示在订阅源名称左侧，尺寸为 16×16pt
- 无 favicon 的订阅源使用一个通用的默认图标占位（如灰色的 RSS 图标或地球图标）
- Favicon 在左键菜单和右键菜单中均展示

**缓存策略**:
- Favicon 以 PNG/ICO 格式缓存在本地应用数据目录中
- 缓存以订阅源域名为 key，避免重复存储

---

## 4. 不包含在本次版本中的内容

以下功能明确排除在本次 minor 版本之外，可作为后续迭代方向：

- 全文搜索（搜索文章正文内容）
- 多 Tag 支持（一个订阅源关联多个 Tag）
- Tag 独立管理界面（增删改查）
- 未分组订阅源作为整体的批量已读
- Favicon 手动上传/自定义
- 搜索历史记录

---

## 5. 技术备注

- **搜索实现**: 建议基于本地 SQLite FTS（全文搜索）或内存过滤实现，避免引入外部搜索引擎依赖
- **NSMenu 搜索框**: macOS 的 `NSMenu` 原生不支持内嵌搜索框，需要通过 `NSMenuItem` 嵌入自定义 `NSView`（包含 `NSSearchField`）实现，注意处理键盘事件的响应链问题
- **Favicon 获取**: 建议按优先级尝试：HTML `<link>` 标签 → `/favicon.ico` 路径 → Google Favicon API（`https://www.google.com/s2/favicons?domain=`）作为兜底
- **分组数据持久化**: Tag 字段作为订阅源模型的新增属性，需要数据库 migration
